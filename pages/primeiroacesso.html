<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Primeiro Acesso - ONG Novo Amanhã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="../css/styles.css" rel="stylesheet"/>

</head>
<body>
    <div class="login-container">
        <h1 class="login-title">BETA</h1>
        <h1 class="login-title">Plataforma de Gestão</h1>
        <p class="login-subtitle">Cadastre-se para continuar</p>
        
        <form id="formPrimeiroAcesso">
            <div class="form-group">
                <label class="form-label" for="nome">
                    <span class="sr-only">Nome Completo</span>
                </label>
                <div class="input-group">
                    <input type="text" class="form-control" id="nome" required 
                           aria-label="Nome Completo" data-tooltip="Digite seu nome completo"
                           pattern="[A-Za-zÀ-ÿ ]+$" title="Digite um nome válido (apenas letras)"
                           placeholder="Nome completo">
                    <i class="fas fa-user input-icon"></i>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="telefone">
                    <span class="sr-only">Telefone</span>
                </label>
                <div class="input-group">
                    <input type="tel" class="form-control" id="telefone" required 
                           aria-label="Telefone" data-tooltip="Digite seu telefone"
                           placeholder="(00) 00000-0000">
                    <i class="fas fa-phone input-icon"></i>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="email">
                    <span class="sr-only">E-mail</span>
                </label>
                <div class="input-group">
                    <input type="email" class="form-control" id="email" required 
                           aria-label="E-mail" data-tooltip="Digite um e-mail válido"
                           placeholder="Digite seu e-mail">
                    <i class="fas fa-envelope input-icon"></i>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="senha">
                    <span class="sr-only">Senha</span>
                </label>
                <div class="input-group">
                    <input type="password" class="form-control" id="senha" required 
                           minlength="6" aria-label="Senha" data-tooltip="Mínimo de 6 caracteres"
                           placeholder="Crie uma senha forte">
                    <i class="fas fa-lock input-icon"></i>
                    <button type="button" class="password-toggle" aria-label="Mostrar senha">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="password-strength"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="confirmarSenha">
                    <span class="sr-only">Confirmar Senha</span>
                </label>
                <div class="input-group">
                    <input type="password" class="form-control" id="confirmarSenha" required 
                           minlength="6" aria-label="Confirmar Senha" data-tooltip="Repita a senha"
                           placeholder="Confirme sua senha">
                    <small class="text-danger password-match-message" style="display: none; position: absolute; bottom: -20px; left: 0;">As senhas não coincidem</small>
                    <i class="fas fa-lock input-icon"></i>
                    <button type="button" class="password-toggle" aria-label="Mostrar senha">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn-entrar">
                <span>Cadastrar</span>
                <div class="spinner">
                    <i class="fas fa-circle-notch fa-spin"></i>
                </div>
            </button>

            <div class="links-container">
                <a href="../index.html" data-tooltip="Voltar para o login">
                    <i class="fas fa-arrow-left"></i> Já possui conta? Faça login
                </a>
            </div>

            <div class="mensagem" role="alert"></div>

            <div class="copyright">
                Desenvolvido por quem aprende, para quem transforma.
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('formPrimeiroAcesso');
            const senhaInput = document.getElementById('senha');
            const confirmarSenhaInput = document.getElementById('confirmarSenha');
            const passwordMatchMessage = document.querySelector('.password-match-message');

            function validatePasswords() {
                if (confirmarSenhaInput.value && senhaInput.value !== confirmarSenhaInput.value) {
                    passwordMatchMessage.style.display = 'block';
                    confirmarSenhaInput.setCustomValidity('As senhas não coincidem');
                } else {
                    passwordMatchMessage.style.display = 'none';
                    confirmarSenhaInput.setCustomValidity('');
                }
            }

            senhaInput.addEventListener('input', validatePasswords);
            confirmarSenhaInput.addEventListener('input', validatePasswords);
            const telefoneInput = document.getElementById('telefone');
            const mensagemDiv = document.querySelector('.mensagem');
            const passwordStrength = document.querySelector('.password-strength');

            // Máscara para telefone
            telefoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
                    e.target.value = value;
                }
            });

            // Toggle senha
            document.querySelectorAll('.password-toggle').forEach(button => {
                button.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input');
                    const type = input.type === 'password' ? 'text' : 'password';
                    input.type = type;
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            });

            // Validador de força da senha
            senhaInput.addEventListener('input', function() {
                const senha = this.value;
                let forca = 0;
                let cor = '';

                if (senha.length >= 6) forca++;
                if (senha.match(/[A-Z]/)) forca++;
                if (senha.match(/[0-9]/)) forca++;
                if (senha.match(/[^A-Za-z0-9]/)) forca++;

                switch(forca) {
                    case 0:
                    case 1:
                        cor = '#ff4d4d';
                        break;
                    case 2:
                        cor = '#ffd700';
                        break;
                    case 3:
                        cor = '#2ecc71';
                        break;
                    case 4:
                        cor = '#27ae60';
                        break;
                }

                passwordStrength.style.width = (forca * 25) + '%';
                passwordStrength.style.backgroundColor = cor;
            });

            // Validar senhas iguais
            confirmarSenhaInput.addEventListener('input', function() {
                if (this.value !== senhaInput.value) {
                    this.setCustomValidity('As senhas não coincidem');
                } else {
                    this.setCustomValidity('');
                }
            });

            // Submit do formulário
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const button = this.querySelector('.btn-entrar');
                button.classList.add('loading');

                // Simulando validação
                setTimeout(() => {
                    // Simulando cadastro bem-sucedido
                    mensagemDiv.textContent = 'Cadastro realizado com sucesso! Redirecionando...';
                    mensagemDiv.className = 'mensagem sucesso';
                    
                    setTimeout(() => {
                        window.location.href = '../index.html';
                    }, 2000);
                }, 1500);
            });
        });
    </script>
<script type="module">
    // Adicionar máscara para telefone
    document.getElementById('telefone').addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length <= 11) {
        value = value.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
        e.target.value = value;
      }
    });

    // Função de cadastro simplificada
    document.getElementById('cadastroForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const senha = document.getElementById('senhaCadastro').value;
      const confirmarSenha = document.getElementById('confirmarSenha').value;
      const mensagemElement = document.getElementById('mensagem');

      if (senha !== confirmarSenha) {
        mensagemElement.innerHTML = '<div class="alert alert-danger">As senhas não coincidem!</div>';
        return;
      }

      try {
        // Simular cadastro bem-sucedido
        const novoUsuario = {
          id: 'user-' + Date.now(),
          nome: nome,
          email: email,
          telefone: telefone,
          dataNascimento: dataNascimento,
          perfil: "usuario",
          dataCriacao: new Date().toISOString()
        };

        // Salvar no localStorage (apenas para demonstração)
        const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
        usuarios.push(novoUsuario);
        localStorage.setItem('usuarios', JSON.stringify(usuarios));

        // Salvar usuário logado
        localStorage.setItem('user', JSON.stringify({
          id: novoUsuario.id,
          email: novoUsuario.email,
          name: novoUsuario.nome
        }));

        mensagemElement.innerHTML = '<div class="alert alert-success">Cadastro realizado com sucesso! Redirecionando...</div>';
        
        // Redirecionar após 2 segundos
        setTimeout(() => {
          window.location.href = "../index.html";
        }, 2000);

      } catch (error) {
        console.error("Erro no cadastro:", error);
        let errorMessage = "Erro ao cadastrar. Tente novamente.";
        
        // Verificar se o e-mail já existe
        const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
        if (usuarios.some(u => u.email === email)) {
          errorMessage = "Este e-mail já está em uso.";
        } else if (senha.length < 6) {
          errorMessage = "A senha deve ter pelo menos 6 caracteres.";
        } else if (!email.includes('@') || !email.includes('.')) {
          errorMessage = "E-mail inválido.";
        }
        
        mensagemElement.innerHTML = `<div class="alert alert-danger">${errorMessage}</div>`;
      }
      });
    </script>

    <script src="../utils/default.js"></script>
    <script src="../data/simulacoes.js"></script>
  </body>
</html>
